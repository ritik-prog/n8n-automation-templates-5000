{
  "name": "generate-time-off-request-approval-workflows",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "pto-request"
      },
      "id": "to1",
      "name": "Request Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        100,
        260
      ]
    },
    {
      "parameters": {
        "functionCode": "const b=$json.body||$json; return [{json:{employee:b.employee, email:b.email, manager:b.manager, start:b.start, end:b.end, reason:b.reason||''}}];"
      },
      "id": "to2",
      "name": "Normalize",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        320,
        260
      ]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "send",
        "fromEmail": "hr@yourcompany.com",
        "toEmail": "={{$json.manager}}",
        "subject": "PTO approval needed: {{$json.employee}}",
        "text": "Approve: https://yourdomain.com/pto-approve?e={{encodeURIComponent($json.email)}}&s={{encodeURIComponent($json.start)}}&en={{encodeURIComponent($json.end)}}\nDeny: https://yourdomain.com/pto-deny?e={{encodeURIComponent($json.email)}}&s={{encodeURIComponent($json.start)}}&en={{encodeURIComponent($json.end)}}"
      },
      "id": "to3",
      "name": "Email Manager",
      "type": "n8n-nodes-base.smtp",
      "typeVersion": 1,
      "position": [
        540,
        240
      ],
      "credentials": {
        "smtp": {
          "id": "smtp_cred",
          "name": "SMTP"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "GET",
        "path": "pto-approve"
      },
      "id": "to4",
      "name": "Approve Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        100,
        520
      ]
    },
    {
      "parameters": {
        "httpMethod": "GET",
        "path": "pto-deny"
      },
      "id": "to5",
      "name": "Deny Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        100,
        640
      ]
    },
    {
      "parameters": {
        "functionCode": "const q=$json.query||{}; return [{json:{email:q.e,start:q.s,end:q.en,decision:'approved'}}];"
      },
      "id": "to6",
      "name": "Normalize Approve",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        320,
        520
      ]
    },
    {
      "parameters": {
        "functionCode": "const q=$json.query||{}; return [{json:{email:q.e,start:q.s,end:q.en,decision:'denied'}}];"
      },
      "id": "to7",
      "name": "Normalize Deny",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        320,
        640
      ]
    },
    {
      "parameters": {
        "sheetId": "pto-sheet-id",
        "range": "Requests!A1",
        "fields": [
          "={{$json.email}}",
          "={{$json.start}}",
          "={{$json.end}}",
          "={{$json.decision}}",
          "={{$now}}"
        ]
      },
      "id": "to8",
      "name": "Log Decision (Sheets)",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 1,
      "position": [
        540,
        580
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "google_sheets_cred",
          "name": "Google Sheets"
        }
      }
    },
    {
      "parameters": {
        "url": "https://www.googleapis.com/calendar/v3/calendars/primary/events",
        "authentication": "none",
        "jsonParameters": true,
        "options": {
          "headersUi": {
            "parameter": [
              {
                "name": "Authorization",
                "value": "Bearer {{$credentials.googleapisToken}}"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          }
        },
        "options_json": {
          "summary": "={{'PTO: '+$json.email}}",
          "start": {
            "date": "={{$json.start}}"
          },
          "end": {
            "date": "={{$json.end}}"
          },
          "description": "Approved PTO"
        }
      },
      "id": "to9",
      "name": "Create Calendar Event",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [
        760,
        540
      ]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "send",
        "fromEmail": "hr@yourcompany.com",
        "toEmail": "={{$json.email}}",
        "subject": "Your PTO request was {{$json.decision}}",
        "text": "Hi, your PTO {{$json.decision}} for {{$json.start}} to {{$json.end}}."
      },
      "id": "to10",
      "name": "Notify Employee",
      "type": "n8n-nodes-base.smtp",
      "typeVersion": 1,
      "position": [
        980,
        580
      ],
      "credentials": {
        "smtp": {
          "id": "smtp_cred",
          "name": "SMTP"
        }
      }
    },
    {
      "parameters": {
        "channel": "#people-ops",
        "text": "PTO {{$json.decision}} for {{$json.email}} ({{$json.start}} \u2192 {{$json.end}})"
      },
      "id": "to11",
      "name": "Slack Notify",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 1,
      "position": [
        1200,
        580
      ]
    }
  ],
  "connections": {
    "Request Webhook": {
      "main": [
        [
          {
            "node": "Normalize",
            "type": "main",
            "index": 0
          },
          {
            "node": "Email Manager",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Approve Webhook": {
      "main": [
        [
          {
            "node": "Normalize Approve",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Deny Webhook": {
      "main": [
        [
          {
            "node": "Normalize Deny",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Normalize Approve": {
      "main": [
        [
          {
            "node": "Log Decision (Sheets)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Create Calendar Event",
            "type": "main",
            "index": 0
          },
          {
            "node": "Notify Employee",
            "type": "main",
            "index": 0
          },
          {
            "node": "Slack Notify",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Normalize Deny": {
      "main": [
        [
          {
            "node": "Log Decision (Sheets)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Notify Employee",
            "type": "main",
            "index": 0
          },
          {
            "node": "Slack Notify",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false
}