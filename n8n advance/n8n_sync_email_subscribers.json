{
    "name": "Sync Email Subscribers Across Marketing Platforms",
    "nodes": [
        {
            "id": "1",
            "name": "Webhook for New Subscriber A",
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 1,
            "position": [
                250,
                300
            ],
            "parameters": {
                "httpMethod": "POST",
                "path": "platform-a-new-subscriber"
            }
        },
        {
            "id": "2",
            "name": "Get Subscribers from Platform B",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 1,
            "position": [
                450,
                300
            ],
            "parameters": {
                "url": "https://api.platformb.com/v1/subscribers",
                "method": "GET",
                "authentication": "oAuth2",
                "oAuth2": {
                    "credentialName": "PlatformB OAuth2"
                }
            }
        },
        {
            "id": "3",
            "name": "Deduplicate Subscribers",
            "type": "n8n-nodes-base.function",
            "typeVersion": 1,
            "position": [
                650,
                300
            ],
            "parameters": {
                "functionCode": "const emailSet = new Set();\nconst uniqueSubs = [];\nfor (const item of items) {\n  if (!emailSet.has(item.json.email)) {\n    uniqueSubs.push(item);\n    emailSet.add(item.json.email);\n  }\n}\nreturn uniqueSubs;"
            }
        },
        {
            "id": "4",
            "name": "Upsert Subscriber to Platform A",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 1,
            "position": [
                850,
                220
            ],
            "parameters": {
                "url": "https://api.platforma.com/v1/subscribers/upsert",
                "method": "POST",
                "authentication": "oAuth2",
                "oAuth2": {
                    "credentialName": "PlatformA OAuth2"
                },
                "bodyParametersUi": {
                    "parameter": [
                        {
                            "name": "email",
                            "value": "={{$json[\"email\"]}}"
                        },
                        {
                            "name": "name",
                            "value": "={{$json[\"name\"]}}"
                        }
                    ]
                }
            }
        },
        {
            "id": "5",
            "name": "Upsert Subscriber to Platform B",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 1,
            "position": [
                1050,
                220
            ],
            "parameters": {
                "url": "https://api.platformb.com/v1/subscribers/upsert",
                "method": "POST",
                "authentication": "oAuth2",
                "oAuth2": {
                    "credentialName": "PlatformB OAuth2"
                },
                "bodyParametersUi": {
                    "parameter": [
                        {
                            "name": "email",
                            "value": "={{$json[\"email\"]}}"
                        },
                        {
                            "name": "name",
                            "value": "={{$json[\"name\"]}}"
                        }
                    ]
                }
            }
        }
    ],
    "connections": {
        "1": {
            "main": [
                [
                    {
                        "node": "3",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "2": {
            "main": [
                [
                    {
                        "node": "3",
                        "type": "main",
                        "index": 1
                    }
                ]
            ]
        },
        "3": {
            "main": [
                [
                    {
                        "node": "4",
                        "type": "main",
                        "index": 0
                    },
                    {
                        "node": "5",
                        "type": "main",
                        "index": 1
                    }
                ]
            ]
        }
    }
}